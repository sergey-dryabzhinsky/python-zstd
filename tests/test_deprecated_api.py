# -*- encoding: utf-8 -*-
# Tests of deprecated APIs (other than compress_old and decompress_old,
# which are tested in test_compress.py).

import sys
import warnings

import zstd
from tests.base import BaseTestZSTD

class DeprecatedAPI(BaseTestZSTD):

    def call_deprecated(self, fname, *args, **kwargs):
        fn = getattr(zstd, fname, None)
        if fn is None:
            self.skipTest("zstd.%s not present in this build" % fname)
        with self._testingDeprecated(fname):
            return fn(*args, **kwargs)


    def test_version(self):
        ver = self.call_deprecated("version")
        self.assertEqual(ver, zstd.VERSION)

    def test_ZSTD_version(self):
        ver = self.call_deprecated("ZSTD_version")
        self.assertEqual(ver, zstd.library_version())

    def test_ZSTD_version_number(self):
        ver = self.call_deprecated("ZSTD_version_number")
        self.assertEqual(ver, zstd.library_version_number())


    def test_ZSTD_compress(self):
        cdata = self.call_deprecated("ZSTD_compress", tDATA)
        self.assertEqual(cdata, cDATA)

    def test_dumps(self):
        cdata = self.call_deprecated("dumps", tDATA)
        self.assertEqual(cdata, cDATA)


    def test_ZSTD_uncompress(self):
        tdata = self.call_deprecated("ZSTD_uncompress", cDATA)
        self.assertEqual(tdata, tDATA)

    def test_uncompress(self):
        tdata = self.call_deprecated("uncompress", cDATA)
        self.assertEqual(tdata, tDATA)

    def test_ZSTD_loads(self):
        tdata = self.call_deprecated("loads", cDATA)
        self.assertEqual(tdata, tDATA)


###
# Test data: Chao Yuen-Ren (趙元任)'s famous Mandarin tongue twister,
# "Lion-Eating Poet in the Stone Den"
tDATA = u"""
《施氏食獅史》

石室詩士施氏，嗜獅，誓食十獅。
氏時時適市視獅。
十時，適十獅適市。
是時，適施氏適市。
氏視是十獅，恃矢勢，使是十獅逝世。
氏拾是十獅屍，適石室。
石室濕，氏使侍拭石室。
石室拭，氏始試食是十獅。
食時，始識是十獅屍，實十石獅屍。
試釋是事。

Lion-Eating Poet in the Stone Den

In a stone den was a poet called Shi Shi, who was a lion addict, and
had resolved to eat ten lions. He often went to the market to look for
lions. At ten o’clock, ten lions had just arrived at the market. At
that time, Shi had just arrived at the market. He saw those ten lions,
and using his trusty arrows, caused the ten lions to die. He brought
the corpses of the ten lions to the stone den. The stone den was
damp. He asked his servants to wipe it. After the stone den was wiped,
he tried to eat those ten lions. When he ate, he realized that these
ten lions were in fact ten stone lion corpses. Try to explain this matter.
""".encode("utf-8")

cDATA = (
    b"\x28\xb5\x2f\xfd\x60\x0f\x03\xe5\x12\x00\x46\x9e\x68\x3b\x50\x6b"
    b"\x54\x48\xdc\x2d\x39\x42\x55\x55\x99\xc1\xaa\x35\x18\xbb\xa8\x15"
    b"\x51\x93\x10\xb7\x5b\x66\xd2\x40\xd2\x4d\xcb\x7e\x79\x76\x04\x91"
    b"\x3f\x60\x27\xad\x48\xcc\xa0\xfd\x23\xbd\xad\x06\x80\x3c\xc0\x03"
    b"\x66\x97\xa4\x7b\x67\x66\x4e\x42\x0d\x68\x00\x5a\x00\x4e\x00\x13"
    b"\x93\x06\xc6\xe8\x22\x3a\x55\x64\xb6\x62\x23\x2d\xa0\xdc\x8b\xe8"
    b"\x04\xd2\xdc\x4c\xa7\x84\x09\x81\x34\x17\xd1\xa9\xb2\xb9\x14\xcd"
    b"\x66\x3a\xa5\xca\x85\xf5\x50\x4c\x95\xcd\xad\x6c\x2e\x26\x74\x5d"
    b"\x65\xb2\x61\xd1\x48\x14\xcd\x6e\x1c\x93\x83\x0a\xa5\x8b\xe8\x64"
    b"\xd1\x48\x11\x20\xd8\x8b\xe8\x64\x81\x63\x3d\x9e\xd2\x84\x0b\xd6"
    b"\x62\x23\x39\x97\x4d\x36\x32\x60\xac\x45\x23\x6d\x1c\x13\x26\x74"
    b"\x31\x32\xb7\xc1\x64\xc3\x05\x72\xc6\x6b\x42\x8c\xa9\x08\x21\xf8"
    b"\xf9\x75\xb5\x15\xe1\xe6\xda\x18\x4b\x7f\x95\x9b\xe5\x00\xe7\xa4"
    b"\x07\x60\x97\xf3\x21\xd8\xe1\xb3\x8c\xfc\x3e\x0b\xb0\x84\x8c\xdf"
    b"\x02\x00\xc8\x19\x09\xb8\x4c\xc3\x08\xa4\xb9\x19\x03\x8b\xad\x03"
    b"\xb2\x9a\xcf\xc6\x31\x75\x3c\xa5\x8c\x82\xfd\x64\x9f\xec\x6a\x19"
    b"\x23\x0d\x8c\x11\x26\xf4\x40\xe3\x6a\x18\x6c\x46\x96\xb9\x18\x49"
    b"\x08\x93\xe2\xab\x84\x3e\xd7\x08\xab\x84\x9f\x6c\x47\x79\x9d\xf0"
    b"\x19\xeb\xca\xfe\x40\x39\x24\xc2\x77\x91\xd2\xe6\xaf\x12\x04\x4c"
    b"\x3d\xac\x79\x59\x9b\xc9\x86\xe9\xe0\xe8\x74\xf0\x63\xce\xcb\x1f"
    b"\xb4\x21\x2f\x1d\x73\x4c\xf6\x07\xae\xaa\xf4\xe7\x6f\xe7\xf9\xfc"
    b"\x7c\xe2\x9a\xd5\x29\xbf\x86\xee\xc9\x66\xea\xad\xf8\x5e\x73\xae"
    b"\xa2\xfe\xdf\x10\xae\xb1\xaf\x48\x02\x0a\x1a\xc1\x95\xd5\x0e\xa7"
    b"\x8e\x39\xaf\x0e\x15\xc4\xab\x9d\x52\xfe\xcd\x0e\x59\x3a\x34\xc0"
    b"\x55\xa4\x8e\x7a\xd4\xdf\xe1\xc0\xd5\x47\xf6\x48\xc4\x5e\xf6\x04"
    b"\xf5\xfa\xfc\x51\x3b\x02\xe9\xe7\x22\xb8\x72\x4c\xae\x5e\x23\x74"
    b"\x5a\xee\xa1\x84\x64\xd2\x03\x1e\x1f\xac\x92\xb6\x98\xaa\x58\x55"
    b"\xa8\x61\x0d\x73\x86\x19\xa8\xa2\x21\xac\x68\x18\x30\x02\x00\x0c"
    b"\x42\x33\x11\xc0\x29\x35\x63\x1b\xc2\x0a\xfa\x0f\x7b\x9a\x90\x4f"
    b"\xe5\xc1\xe1\xc8\x91\xde\x57\x49\x3d\x29\x8e\x76\x37\x6a\x1c\x0d"
    b"\xc7\xdc\x8b\xb7\x16\x74\xbc\xcf\x88\x1f\xbe\x40\xa2\xd4\x5c\xbd"
    b"\x83\x48\x05\xc3\xc5\x72\xe9\x03\x54\x83\xd8\x26\x12\x76\x50\x55"
    b"\x71\x11\xcd\x8e\xb8\xb1\x73\x12\x3d\x03\x24\xfb\x64\x95\xbc\x8b"
    b"\x38\xfb\xa3\x08\xf6\x8d\xc5\xb4\x23\xf9\xbc\x08\xd0\x4e\xfe\x10"
    b"\x75\x90\x1b\x68\x23\x35\xd8\x40\xc5\xb3\x7f\xf9\xc2\x29\xac\x19"
    b"\x47\xa0\x81\x6b\x80\x03\xd4\xf0\xde\x15\x1b\x96\x1e\xaa\x6c\xcd"
    b"\xee\x85\x98\x8a\x6e\x3a\x50\x77\x69\xce\xa0\x3d\x57\x6c\xd3\x11"
    b"\x94\xc3\xa9\x3e\xa7\x09\x31\x6f\x9e\x13\x47\x45\x2e\x65\xd0\xa0"
    b"\x79\x55\x1c\x37\xe5\x03"
)

if __name__ == "__main__":
    unittest.main()
